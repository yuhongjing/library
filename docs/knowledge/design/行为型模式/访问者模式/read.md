---
title: 基础概念
---

# 访问者模式

`访问者模式`(Visitor Pattern)属于对象行为型模式。  

## 模式动机

访问者模式的目的是封装一些施加于某种数据结构元素之上的操作，一旦这些操作需要修改的话，接受这个操作的数据结构可以保持不变。为不同类型的元素提供多种访问操作方式，且可以在不修改原有系统的情况下增加新的操作方式，这就是访问者模式的模式动机。

## 模式定义

提供一个作用于某对象结构中的各元素的操作表示，它使我们可以在不改变各元素的类的前提下定义作用于这些元素的新操作。

## 模式结构

访问者模式包含如下角色：

* Vistor：抽象访问者
* ConcreteVisitor：具体访问者
* Element：抽象元素
* ConcreteElement：具体元素
* ObjectStructure：对象结构

## 代码实现

* [PHP实现](./PHP实现.md)
* [JS实现](./JS实现.md)

## 模式分析

访问者模式中对象结构存储了不同类型的元素对象，以供不同的访问者访问。访问者模式包括两个层次结构：

* 访问者层次结构，提供了抽象访问者和具体访问者。
* 元素层次结构，提供了抽象元素和具体元素。

相同的访问者可以以不同的方式访问不同的元素，相同的元素可以接受不同访问者以不同访问方式访问。在访问者模式中，增加新的访问者无须修改原有系统，系统具有较好的可扩展性。

由于访问者模式的使用条件较为苛刻，本身结构较为复杂，因此在实际应用中使用频率不是特别高。当系统中存在一个较为复杂的对象结构，且不同访问者对其所采取的操作也不相同时，可以考虑使用访问者模式进行设计。

## 优点

访问者模式的优点

* 增加新的访问操作很方便。使用访问者模式，增加新的访问操作就意味着增加一个新的具体访问者类，实现简单，无须修改源代码，符合『开闭原则』。
* 将有关元素对象的访问行为集中到一个访问者对象中，而不是分散在一个个的元素类中。类的职责更加清晰，有利于对象结构中元素对象的复用，相同的对象结构可以拱多个不同的访问者访问。
* 让用户能够在不修改现有元素类层次结构的情况下，定义作用于该层次结构的操作。

## 缺点

访问者模式的缺点

* 增加新的元素类很困难。在访问者模式中，每增加一个新的元素类都意味着要在抽象访问者角色中增加一个新的抽象操作，并在每一个具体访问者类中增加相应的具体操作，这违背了『开闭原则』。
* 破坏封装。访问者模式要求访问者对象访问并调用每一个元素对象的操作，这意味着元素对象有时候必须暴露一些自己的内部操作和内部状态，否则无法供访问者访问。

## 适用环境

在以下情况下可以使用访问者模式：

* 一个对象结构包含多个类型的对象，希望对这些对象实施一些依赖其具体类型的操作。在访问者中针对每一种具体的类型都提供了一个访问操作，不同类型的对象可以有不同的访问操作。
* 需要对一个对象结构中的对象进行很多不同的并且不相关的操作，而需要避免让这些操作『污染』这些对象的类，也不希望在增加新操作时修改这些类。访问者模式使得我们可以将相关的访问操作集中起来定义在访问者类中，对象结构可以被多个不同的访问者类所使用，将对象本身与对象的访问操作分离。
* 对象结构中对象对应的类很少改变，但经常需要在此对象结构上定义新的操作。

## 模式扩展

### 访问者模式与组合模式联用

在访问者模式中，包含一个用于存储元素对象集合的对象结构，我们通常可以使用迭代器来遍历对象结构，同时具体元素之间可以存在整体与部分关系，有些元素作为容器对象，有些元素作为成员对象，可以使用组合模式来组织元素。

