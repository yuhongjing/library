<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Immer | 余鸿靖的手册小站</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/library/logo.png">
    <link rel="manifest" href="/library/manifest.json">
    <link rel="apple-touch-icon" href="/library/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/library/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="小站目前有263篇文章共531757字，继续努力">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/library/assets/css/0.styles.e14e970c.css" as="style"><link rel="preload" href="/library/assets/js/app.68a91983.js" as="script"><link rel="preload" href="/library/assets/js/2.d8add0a0.js" as="script"><link rel="preload" href="/library/assets/js/210.c0753af3.js" as="script"><link rel="preload" href="/library/assets/js/3.dc7ea838.js" as="script"><link rel="prefetch" href="/library/assets/js/10.3e53577f.js"><link rel="prefetch" href="/library/assets/js/100.4313408d.js"><link rel="prefetch" href="/library/assets/js/101.0de444ee.js"><link rel="prefetch" href="/library/assets/js/102.4601a32d.js"><link rel="prefetch" href="/library/assets/js/103.b96f5df3.js"><link rel="prefetch" href="/library/assets/js/104.760c87ab.js"><link rel="prefetch" href="/library/assets/js/105.731bd603.js"><link rel="prefetch" href="/library/assets/js/106.b4dd0fdd.js"><link rel="prefetch" href="/library/assets/js/107.ec4f3902.js"><link rel="prefetch" href="/library/assets/js/108.a45dede5.js"><link rel="prefetch" href="/library/assets/js/109.176158c3.js"><link rel="prefetch" href="/library/assets/js/11.d7d274e8.js"><link rel="prefetch" href="/library/assets/js/110.f9586dbc.js"><link rel="prefetch" href="/library/assets/js/111.3c1e8d86.js"><link rel="prefetch" href="/library/assets/js/112.24acb74b.js"><link rel="prefetch" href="/library/assets/js/113.a8333b64.js"><link rel="prefetch" href="/library/assets/js/114.7096f694.js"><link rel="prefetch" href="/library/assets/js/115.2c475c17.js"><link rel="prefetch" href="/library/assets/js/116.7dfb800c.js"><link rel="prefetch" href="/library/assets/js/117.66f271a9.js"><link rel="prefetch" href="/library/assets/js/118.6afbeec6.js"><link rel="prefetch" href="/library/assets/js/119.e77c2608.js"><link rel="prefetch" href="/library/assets/js/12.1894fb4f.js"><link rel="prefetch" href="/library/assets/js/120.ee663923.js"><link rel="prefetch" href="/library/assets/js/121.e3d75a7c.js"><link rel="prefetch" href="/library/assets/js/122.3dc73c97.js"><link rel="prefetch" href="/library/assets/js/123.356ec1d5.js"><link rel="prefetch" href="/library/assets/js/124.7987aa80.js"><link rel="prefetch" href="/library/assets/js/125.11c0f627.js"><link rel="prefetch" href="/library/assets/js/126.e7428124.js"><link rel="prefetch" href="/library/assets/js/127.980acf43.js"><link rel="prefetch" href="/library/assets/js/128.945affe5.js"><link rel="prefetch" href="/library/assets/js/129.66745865.js"><link rel="prefetch" href="/library/assets/js/13.afc9ead8.js"><link rel="prefetch" href="/library/assets/js/130.290d67d9.js"><link rel="prefetch" href="/library/assets/js/131.f2d07668.js"><link rel="prefetch" href="/library/assets/js/132.543257ae.js"><link rel="prefetch" href="/library/assets/js/133.36a4f4be.js"><link rel="prefetch" href="/library/assets/js/134.c4f6708e.js"><link rel="prefetch" href="/library/assets/js/135.ded0b801.js"><link rel="prefetch" href="/library/assets/js/136.2172b6bb.js"><link rel="prefetch" href="/library/assets/js/137.426fde95.js"><link rel="prefetch" href="/library/assets/js/138.a530915b.js"><link rel="prefetch" href="/library/assets/js/139.0e6cdd27.js"><link rel="prefetch" href="/library/assets/js/14.f2340962.js"><link rel="prefetch" href="/library/assets/js/140.fb179f3a.js"><link rel="prefetch" href="/library/assets/js/141.539148c0.js"><link rel="prefetch" href="/library/assets/js/142.76acdcaf.js"><link rel="prefetch" href="/library/assets/js/143.6f38d5fc.js"><link rel="prefetch" href="/library/assets/js/144.c7396f1c.js"><link rel="prefetch" href="/library/assets/js/145.7ed837e9.js"><link rel="prefetch" href="/library/assets/js/146.81c72593.js"><link rel="prefetch" href="/library/assets/js/147.37c9a89e.js"><link rel="prefetch" href="/library/assets/js/148.403423d9.js"><link rel="prefetch" href="/library/assets/js/149.98491d17.js"><link rel="prefetch" href="/library/assets/js/15.181de6b2.js"><link rel="prefetch" href="/library/assets/js/150.9b6e682c.js"><link rel="prefetch" href="/library/assets/js/151.de35ebbe.js"><link rel="prefetch" href="/library/assets/js/152.29f6a817.js"><link rel="prefetch" href="/library/assets/js/153.66618aae.js"><link rel="prefetch" href="/library/assets/js/154.1629e8d3.js"><link rel="prefetch" href="/library/assets/js/155.4d06125b.js"><link rel="prefetch" href="/library/assets/js/156.0daed4ad.js"><link rel="prefetch" href="/library/assets/js/157.6c1b04a0.js"><link rel="prefetch" href="/library/assets/js/158.936eebe2.js"><link rel="prefetch" href="/library/assets/js/159.40d9fc81.js"><link rel="prefetch" href="/library/assets/js/16.49ed3ac9.js"><link rel="prefetch" href="/library/assets/js/160.f97b4814.js"><link rel="prefetch" href="/library/assets/js/161.eed424e7.js"><link rel="prefetch" href="/library/assets/js/162.6e162b03.js"><link rel="prefetch" href="/library/assets/js/163.9c2a8507.js"><link rel="prefetch" href="/library/assets/js/164.a6af8596.js"><link rel="prefetch" href="/library/assets/js/165.0ed95d9b.js"><link rel="prefetch" href="/library/assets/js/166.8469bd46.js"><link rel="prefetch" href="/library/assets/js/167.c72220e4.js"><link rel="prefetch" href="/library/assets/js/168.26fc507f.js"><link rel="prefetch" href="/library/assets/js/169.c580b48a.js"><link rel="prefetch" href="/library/assets/js/17.85e4dc44.js"><link rel="prefetch" href="/library/assets/js/170.533eb040.js"><link rel="prefetch" href="/library/assets/js/171.fe321d6b.js"><link rel="prefetch" href="/library/assets/js/172.72b9654f.js"><link rel="prefetch" href="/library/assets/js/173.0001cb89.js"><link rel="prefetch" href="/library/assets/js/174.d39b0038.js"><link rel="prefetch" href="/library/assets/js/175.21fd830d.js"><link rel="prefetch" href="/library/assets/js/176.f19c6233.js"><link rel="prefetch" href="/library/assets/js/177.6da87dd9.js"><link rel="prefetch" href="/library/assets/js/178.cb030c1e.js"><link rel="prefetch" href="/library/assets/js/179.ec7b1110.js"><link rel="prefetch" href="/library/assets/js/18.cad1acf4.js"><link rel="prefetch" href="/library/assets/js/180.82c26b12.js"><link rel="prefetch" href="/library/assets/js/181.d095ebc1.js"><link rel="prefetch" href="/library/assets/js/182.c315b10e.js"><link rel="prefetch" href="/library/assets/js/183.e4e60734.js"><link rel="prefetch" href="/library/assets/js/184.7522521c.js"><link rel="prefetch" href="/library/assets/js/185.6f45603f.js"><link rel="prefetch" href="/library/assets/js/186.9fa420cb.js"><link rel="prefetch" href="/library/assets/js/187.ff3a1687.js"><link rel="prefetch" href="/library/assets/js/188.df4bb90c.js"><link rel="prefetch" href="/library/assets/js/189.c02cce65.js"><link rel="prefetch" href="/library/assets/js/19.2f47bab5.js"><link rel="prefetch" href="/library/assets/js/190.17dfb278.js"><link rel="prefetch" href="/library/assets/js/191.206cf52c.js"><link rel="prefetch" href="/library/assets/js/192.5df1db35.js"><link rel="prefetch" href="/library/assets/js/193.e3262bd5.js"><link rel="prefetch" href="/library/assets/js/194.d2d6b8e2.js"><link rel="prefetch" href="/library/assets/js/195.67d0bc39.js"><link rel="prefetch" href="/library/assets/js/196.49ab7c99.js"><link rel="prefetch" href="/library/assets/js/197.dc4990a1.js"><link rel="prefetch" href="/library/assets/js/198.69e843ee.js"><link rel="prefetch" href="/library/assets/js/199.0ceab1dc.js"><link rel="prefetch" href="/library/assets/js/20.c736161e.js"><link rel="prefetch" href="/library/assets/js/200.d0571510.js"><link rel="prefetch" href="/library/assets/js/201.15fd84b0.js"><link rel="prefetch" href="/library/assets/js/202.38640d20.js"><link rel="prefetch" href="/library/assets/js/203.b902bf63.js"><link rel="prefetch" href="/library/assets/js/204.213333de.js"><link rel="prefetch" href="/library/assets/js/205.15cbf150.js"><link rel="prefetch" href="/library/assets/js/206.e5e48882.js"><link rel="prefetch" href="/library/assets/js/207.8af21bc4.js"><link rel="prefetch" href="/library/assets/js/208.e61ae231.js"><link rel="prefetch" href="/library/assets/js/209.b2c16aec.js"><link rel="prefetch" href="/library/assets/js/21.c67a6b74.js"><link rel="prefetch" href="/library/assets/js/211.831e171b.js"><link rel="prefetch" href="/library/assets/js/212.3b636945.js"><link rel="prefetch" href="/library/assets/js/213.674c1979.js"><link rel="prefetch" href="/library/assets/js/214.ed4415ea.js"><link rel="prefetch" href="/library/assets/js/215.cb767bd8.js"><link rel="prefetch" href="/library/assets/js/216.d8761c97.js"><link rel="prefetch" href="/library/assets/js/217.b3b0ad92.js"><link rel="prefetch" href="/library/assets/js/218.4422ed98.js"><link rel="prefetch" href="/library/assets/js/219.ade3aa98.js"><link rel="prefetch" href="/library/assets/js/22.acb78e53.js"><link rel="prefetch" href="/library/assets/js/220.793924f3.js"><link rel="prefetch" href="/library/assets/js/221.ede25e02.js"><link rel="prefetch" href="/library/assets/js/222.b621cc59.js"><link rel="prefetch" href="/library/assets/js/223.b5a033d7.js"><link rel="prefetch" href="/library/assets/js/224.8d4a70c4.js"><link rel="prefetch" href="/library/assets/js/225.dc50d7bf.js"><link rel="prefetch" href="/library/assets/js/226.ca0b9434.js"><link rel="prefetch" href="/library/assets/js/227.0f30236c.js"><link rel="prefetch" href="/library/assets/js/228.a4696b2e.js"><link rel="prefetch" href="/library/assets/js/229.bb47bd03.js"><link rel="prefetch" href="/library/assets/js/23.593d0cae.js"><link rel="prefetch" href="/library/assets/js/230.99c8eea4.js"><link rel="prefetch" href="/library/assets/js/231.616559b9.js"><link rel="prefetch" href="/library/assets/js/232.b65367f5.js"><link rel="prefetch" href="/library/assets/js/233.ec67d608.js"><link rel="prefetch" href="/library/assets/js/234.bbd8f89d.js"><link rel="prefetch" href="/library/assets/js/235.67f8f982.js"><link rel="prefetch" href="/library/assets/js/236.710ddb48.js"><link rel="prefetch" href="/library/assets/js/237.9730acab.js"><link rel="prefetch" href="/library/assets/js/238.d83742b0.js"><link rel="prefetch" href="/library/assets/js/239.eea7c0b5.js"><link rel="prefetch" href="/library/assets/js/24.fbb3c91d.js"><link rel="prefetch" href="/library/assets/js/240.b5921beb.js"><link rel="prefetch" href="/library/assets/js/241.043f9f14.js"><link rel="prefetch" href="/library/assets/js/242.2c979735.js"><link rel="prefetch" href="/library/assets/js/243.d8bb9b20.js"><link rel="prefetch" href="/library/assets/js/244.04dee825.js"><link rel="prefetch" href="/library/assets/js/245.c705eaf9.js"><link rel="prefetch" href="/library/assets/js/246.28b48a83.js"><link rel="prefetch" href="/library/assets/js/247.7193e968.js"><link rel="prefetch" href="/library/assets/js/248.d5da4738.js"><link rel="prefetch" href="/library/assets/js/249.051e590a.js"><link rel="prefetch" href="/library/assets/js/25.ce424363.js"><link rel="prefetch" href="/library/assets/js/250.206a2678.js"><link rel="prefetch" href="/library/assets/js/251.09ce1b9a.js"><link rel="prefetch" href="/library/assets/js/252.7c183bf1.js"><link rel="prefetch" href="/library/assets/js/253.d179a0c1.js"><link rel="prefetch" href="/library/assets/js/254.56a07c37.js"><link rel="prefetch" href="/library/assets/js/255.08bcefb9.js"><link rel="prefetch" href="/library/assets/js/256.9555d822.js"><link rel="prefetch" href="/library/assets/js/257.c83c3e13.js"><link rel="prefetch" href="/library/assets/js/258.3b707763.js"><link rel="prefetch" href="/library/assets/js/259.e1dbd4c2.js"><link rel="prefetch" href="/library/assets/js/26.71adc271.js"><link rel="prefetch" href="/library/assets/js/260.ba432fb2.js"><link rel="prefetch" href="/library/assets/js/261.c3ac35f3.js"><link rel="prefetch" href="/library/assets/js/262.a00bdad6.js"><link rel="prefetch" href="/library/assets/js/263.633a1eef.js"><link rel="prefetch" href="/library/assets/js/264.ac40ff68.js"><link rel="prefetch" href="/library/assets/js/265.dda458a3.js"><link rel="prefetch" href="/library/assets/js/266.d6088c71.js"><link rel="prefetch" href="/library/assets/js/267.b518a63a.js"><link rel="prefetch" href="/library/assets/js/268.52402cc5.js"><link rel="prefetch" href="/library/assets/js/269.8c3b2691.js"><link rel="prefetch" href="/library/assets/js/27.12c8fd34.js"><link rel="prefetch" href="/library/assets/js/270.bc463510.js"><link rel="prefetch" href="/library/assets/js/28.9694d7a5.js"><link rel="prefetch" href="/library/assets/js/29.d24f2732.js"><link rel="prefetch" href="/library/assets/js/30.4f79d00c.js"><link rel="prefetch" href="/library/assets/js/31.64f12c7c.js"><link rel="prefetch" href="/library/assets/js/32.ce85df91.js"><link rel="prefetch" href="/library/assets/js/33.309e67c0.js"><link rel="prefetch" href="/library/assets/js/34.f7b9cc96.js"><link rel="prefetch" href="/library/assets/js/35.f8d15ff5.js"><link rel="prefetch" href="/library/assets/js/36.776bc8a2.js"><link rel="prefetch" href="/library/assets/js/37.457e759d.js"><link rel="prefetch" href="/library/assets/js/38.96ffcba2.js"><link rel="prefetch" href="/library/assets/js/39.867a2c5b.js"><link rel="prefetch" href="/library/assets/js/4.a93ed1db.js"><link rel="prefetch" href="/library/assets/js/40.3944e285.js"><link rel="prefetch" href="/library/assets/js/41.42b33ab3.js"><link rel="prefetch" href="/library/assets/js/42.db07272e.js"><link rel="prefetch" href="/library/assets/js/43.0137b4a2.js"><link rel="prefetch" href="/library/assets/js/44.2a6cbcf9.js"><link rel="prefetch" href="/library/assets/js/45.a9091b6f.js"><link rel="prefetch" href="/library/assets/js/46.853942de.js"><link rel="prefetch" href="/library/assets/js/47.97b1e839.js"><link rel="prefetch" href="/library/assets/js/48.c4ac047a.js"><link rel="prefetch" href="/library/assets/js/49.bbaa5985.js"><link rel="prefetch" href="/library/assets/js/5.05556a24.js"><link rel="prefetch" href="/library/assets/js/50.24cd449c.js"><link rel="prefetch" href="/library/assets/js/51.ec701789.js"><link rel="prefetch" href="/library/assets/js/52.d1027306.js"><link rel="prefetch" href="/library/assets/js/53.69cdaee8.js"><link rel="prefetch" href="/library/assets/js/54.904af115.js"><link rel="prefetch" href="/library/assets/js/55.0dffeb20.js"><link rel="prefetch" href="/library/assets/js/56.823b74ff.js"><link rel="prefetch" href="/library/assets/js/57.9b95b2ff.js"><link rel="prefetch" href="/library/assets/js/58.151bec45.js"><link rel="prefetch" href="/library/assets/js/59.c59fa94c.js"><link rel="prefetch" href="/library/assets/js/6.23958750.js"><link rel="prefetch" href="/library/assets/js/60.4c1aa094.js"><link rel="prefetch" href="/library/assets/js/61.40718ddd.js"><link rel="prefetch" href="/library/assets/js/62.43c9349e.js"><link rel="prefetch" href="/library/assets/js/63.e68646b2.js"><link rel="prefetch" href="/library/assets/js/64.d6ef247e.js"><link rel="prefetch" href="/library/assets/js/65.c179d010.js"><link rel="prefetch" href="/library/assets/js/66.3459980b.js"><link rel="prefetch" href="/library/assets/js/67.6df3c635.js"><link rel="prefetch" href="/library/assets/js/68.5b3f5904.js"><link rel="prefetch" href="/library/assets/js/69.bd752407.js"><link rel="prefetch" href="/library/assets/js/7.03e822e0.js"><link rel="prefetch" href="/library/assets/js/70.ccd91655.js"><link rel="prefetch" href="/library/assets/js/71.d50f8d01.js"><link rel="prefetch" href="/library/assets/js/72.6ecbfdf7.js"><link rel="prefetch" href="/library/assets/js/73.5bc04529.js"><link rel="prefetch" href="/library/assets/js/74.c42721e2.js"><link rel="prefetch" href="/library/assets/js/75.2f4445e8.js"><link rel="prefetch" href="/library/assets/js/76.aa24954d.js"><link rel="prefetch" href="/library/assets/js/77.23aad328.js"><link rel="prefetch" href="/library/assets/js/78.d1b5971d.js"><link rel="prefetch" href="/library/assets/js/79.ec611ad8.js"><link rel="prefetch" href="/library/assets/js/8.d6759edb.js"><link rel="prefetch" href="/library/assets/js/80.7435d7dc.js"><link rel="prefetch" href="/library/assets/js/81.634192a0.js"><link rel="prefetch" href="/library/assets/js/82.47a9c06c.js"><link rel="prefetch" href="/library/assets/js/83.1b0a38bd.js"><link rel="prefetch" href="/library/assets/js/84.f9d12fbd.js"><link rel="prefetch" href="/library/assets/js/85.59eb4bbd.js"><link rel="prefetch" href="/library/assets/js/86.02d6c544.js"><link rel="prefetch" href="/library/assets/js/87.17c52e42.js"><link rel="prefetch" href="/library/assets/js/88.bc21b3c6.js"><link rel="prefetch" href="/library/assets/js/89.dae2e05d.js"><link rel="prefetch" href="/library/assets/js/9.69158b16.js"><link rel="prefetch" href="/library/assets/js/90.9bf8a060.js"><link rel="prefetch" href="/library/assets/js/91.ee893aac.js"><link rel="prefetch" href="/library/assets/js/92.cbdd1dd6.js"><link rel="prefetch" href="/library/assets/js/93.3fa30e34.js"><link rel="prefetch" href="/library/assets/js/94.a69c505b.js"><link rel="prefetch" href="/library/assets/js/95.c0627d8b.js"><link rel="prefetch" href="/library/assets/js/96.bcf38bf4.js"><link rel="prefetch" href="/library/assets/js/97.4eacdb86.js"><link rel="prefetch" href="/library/assets/js/98.098a822e.js"><link rel="prefetch" href="/library/assets/js/99.ec50dc4b.js">
    <link rel="stylesheet" href="/library/assets/css/0.styles.e14e970c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/library/" class="home-link router-link-active"><!----> <span class="site-name">余鸿靖的手册小站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="手册" class="dropdown-title"><span class="title">手册</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/library/notebook/school/read.html" class="nav-link">
  校招面经
</a></li><li class="dropdown-item"><!----> <a href="/library/notebook/jsTricks/read.html" class="nav-link">
  JS Tricks
</a></li><li class="dropdown-item"><!----> <a href="/library/notebook/cssTricks/read.html" class="nav-link">
  CSS Tricks
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="日常记录" class="dropdown-title"><span class="title">日常记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/library/blog/article/read.html" class="nav-link">
  闲情随记
</a></li><li class="dropdown-item"><!----> <a href="/library/blog/tools/read.html" class="nav-link">
  工具技巧
</a></li><li class="dropdown-item"><!----> <a href="/library/blog/command/read.html" class="nav-link">
  命令整理
</a></li><li class="dropdown-item"><!----> <a href="/library/blog/software/read.html" class="nav-link">
  必备软件
</a></li><li class="dropdown-item"><!----> <a href="/library/blog/other/read.html" class="nav-link">
  文档综合
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识整理" class="dropdown-title"><span class="title">知识整理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/library/knowledge/mindmap/read.html" class="nav-link">
  知识脑图
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/web/read.html" class="nav-link">
  前端知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/backend/read.html" class="nav-link">
  后端知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/database/read.html" class="nav-link">
  数据库知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/algorithm/read.html" class="nav-link">
  算法知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/structure/read.html" class="nav-link">
  数据结构知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/design/read.html" class="nav-link">
  设计模式知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/network/read.html" class="nav-link">
  网络知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/hard/read.html" class="nav-link">
  硬件知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/system/read.html" class="nav-link">
  操作系统知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/config/read.html" class="nav-link">
  环境配置
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/architecture/read.html" class="nav-link">
  项目架构
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/english/read.html" class="nav-link">
  英语知识
</a></li></ul></div></div><div class="nav-item"><a href="/library/readbook/technology.html" class="nav-link">
  阅读
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他项目" class="dropdown-title"><span class="title">其他项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://yuhongjing.github.io/trip/#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  旅行日志
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://pxy1996.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  小裕博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://yuhongjing.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  旧博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/yuhongjing/library" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="手册" class="dropdown-title"><span class="title">手册</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/library/notebook/school/read.html" class="nav-link">
  校招面经
</a></li><li class="dropdown-item"><!----> <a href="/library/notebook/jsTricks/read.html" class="nav-link">
  JS Tricks
</a></li><li class="dropdown-item"><!----> <a href="/library/notebook/cssTricks/read.html" class="nav-link">
  CSS Tricks
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="日常记录" class="dropdown-title"><span class="title">日常记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/library/blog/article/read.html" class="nav-link">
  闲情随记
</a></li><li class="dropdown-item"><!----> <a href="/library/blog/tools/read.html" class="nav-link">
  工具技巧
</a></li><li class="dropdown-item"><!----> <a href="/library/blog/command/read.html" class="nav-link">
  命令整理
</a></li><li class="dropdown-item"><!----> <a href="/library/blog/software/read.html" class="nav-link">
  必备软件
</a></li><li class="dropdown-item"><!----> <a href="/library/blog/other/read.html" class="nav-link">
  文档综合
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识整理" class="dropdown-title"><span class="title">知识整理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/library/knowledge/mindmap/read.html" class="nav-link">
  知识脑图
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/web/read.html" class="nav-link">
  前端知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/backend/read.html" class="nav-link">
  后端知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/database/read.html" class="nav-link">
  数据库知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/algorithm/read.html" class="nav-link">
  算法知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/structure/read.html" class="nav-link">
  数据结构知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/design/read.html" class="nav-link">
  设计模式知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/network/read.html" class="nav-link">
  网络知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/hard/read.html" class="nav-link">
  硬件知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/system/read.html" class="nav-link">
  操作系统知识
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/config/read.html" class="nav-link">
  环境配置
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/architecture/read.html" class="nav-link">
  项目架构
</a></li><li class="dropdown-item"><!----> <a href="/library/knowledge/english/read.html" class="nav-link">
  英语知识
</a></li></ul></div></div><div class="nav-item"><a href="/library/readbook/technology.html" class="nav-link">
  阅读
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他项目" class="dropdown-title"><span class="title">其他项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://yuhongjing.github.io/trip/#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  旅行日志
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://pxy1996.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  小裕博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://yuhongjing.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  旧博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/yuhongjing/library" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/library/knowledge/web/read.html" class="sidebar-link">介绍</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/library/knowledge/web/react/read.html" class="sidebar-link">介绍</a></li><li><a href="/library/knowledge/web/react/编码规范.html" class="sidebar-link">编码规范</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>从零构建React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>从零实现Redux</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/library/knowledge/web/react/完全理解高阶组件.html" class="sidebar-link">完全理解高阶组件</a></li><li><a href="/library/knowledge/web/react/ReactHooks.html" class="sidebar-link">React Hooks</a></li><li><a href="/library/knowledge/web/react/Immer.html" aria-current="page" class="active sidebar-link">Immer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/library/knowledge/web/react/Immer.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/library/knowledge/web/react/Immer.html#immer相关概念" class="sidebar-link">Immer相关概念</a></li><li class="sidebar-sub-header"><a href="/library/knowledge/web/react/Immer.html#常用api介绍" class="sidebar-link">常用API介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/library/knowledge/web/react/Immer.html#第一种使用方式" class="sidebar-link">第一种使用方式</a></li><li class="sidebar-sub-header"><a href="/library/knowledge/web/react/Immer.html#第二种使用方式" class="sidebar-link">第二种使用方式</a></li></ul></li><li class="sidebar-sub-header"><a href="/library/knowledge/web/react/Immer.html#解决问题" class="sidebar-link">解决问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/library/knowledge/web/react/Immer.html#方便的柯里化" class="sidebar-link">方便的柯里化</a></li></ul></li><li class="sidebar-sub-header"><a href="/library/knowledge/web/react/Immer.html#优化redux" class="sidebar-link">优化Redux</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/library/knowledge/web/react/Immer.html#普通reducer怎么解决上面的react需求" class="sidebar-link">普通reducer怎么解决上面的React需求</a></li><li class="sidebar-sub-header"><a href="/library/knowledge/web/react/Immer.html#引入immer后，reducer可以这样写" class="sidebar-link">引入immer后，reducer可以这样写</a></li></ul></li><li class="sidebar-sub-header"><a href="/library/knowledge/web/react/Immer.html#相关文档" class="sidebar-link">相关文档</a></li></ul></li><li><a href="/library/knowledge/web/react/ReduxThunk.html" class="sidebar-link">Redux-thunk</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="immer"><a href="#immer" class="header-anchor">#</a> Immer</h1> <p>Immer是<a href="https://github.com/mobxjs/mobx" target="_blank" rel="noopener noreferrer">Mobx<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的作者<a href="https://github.com/mweststrate" target="_blank" rel="noopener noreferrer">Mweststrate<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>研发的一个<code>immutable</code>库。</p> <p>其核心实现是利用了ES6的proxy，几乎以最小的成本实现了JS的不可变结构。</p> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <div class="language-npm extra-class"><pre class="language-text"><code>npm i --save immer
</code></pre></div><h2 id="immer相关概念"><a href="#immer相关概念" class="header-anchor">#</a> Immer相关概念</h2> <p>Immer涉及概念不多，在此先罗列出来。</p> <ul><li>currentState 被操作对象的原始状态。</li> <li>draftState 根据currentState生成的草稿状态，它是currentState的代理，对draftState所做的任何修改都将被记录并用于生成nextState。在此过程中，currentState将不受影响。</li> <li>nextState 根据draft生成的最终状态。</li> <li>produce 用来生成nextState或producer的函数。</li> <li>producer 通过produce生成，用来生产nextState，每次执行相同的操作。</li> <li>recipe 用来操作draftState的函数。</li></ul> <h2 id="常用api介绍"><a href="#常用api介绍" class="header-anchor">#</a> 常用API介绍</h2> <p>首先引入Immer。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 以下两种引入的produce是相同的</span>
<span class="token keyword">import</span> produce <span class="token keyword">from</span> <span class="token string">'immer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>produce<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'immer'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="第一种使用方式"><a href="#第一种使用方式" class="header-anchor">#</a> 第一种使用方式</h3> <p>语法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">produce</span><span class="token punctuation">(</span>
  currentState<span class="token punctuation">,</span>
  <span class="token function-variable function">recipe</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">draftState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span> <span class="token operator">|</span> draftState<span class="token punctuation">,</span>
  <span class="token operator">?</span>PatchListener
<span class="token punctuation">)</span> <span class="token operator">:</span> nextState
</code></pre></div><p>例子1：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> nextState <span class="token operator">=</span> <span class="token function">produce</span><span class="token punctuation">(</span>currentState<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">draft</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

currentState <span class="token operator">===</span> nextState<span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>例子2：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> currentState <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  p<span class="token operator">:</span> <span class="token punctuation">{</span>
    x<span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> nextState <span class="token operator">=</span> <span class="token function">produce</span><span class="token punctuation">(</span>currentState<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">draft</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  draft<span class="token punctuation">.</span>a<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

currentState<span class="token punctuation">.</span>a <span class="token operator">===</span> nextState<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// false</span>
currentState<span class="token punctuation">.</span>p <span class="token operator">===</span> nextState<span class="token punctuation">.</span>p<span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>由此可见，对draftState的修改都会反应到nextState，而Immer使用的结构是<strong>共享</strong>的，nextState在结构上又与currentState共享未修改的部分，共享效果如图。</p> <p><img src="https://raw.githubusercontent.com/yuhongjing/img-folder/master/img/Immer-tree.gif" alt=""></p> <h4 id="自动冻结功能"><a href="#自动冻结功能" class="header-anchor">#</a> 自动冻结功能</h4> <p>Immer在内部做了一件很巧妙的事情，通过produce生成的nextState是被冻结(freeze)的，(Immer内部使用<code>Object.freeze</code>方法，只冻结nextState跟currentState相比修改的部分)，当直接修改nextState时，将会报错。这使得nextState成为了真正的不可变数据。</p> <p>例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> nextState <span class="token operator">=</span> <span class="token function">produce</span><span class="token punctuation">(</span>currentState<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">draft</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  draft<span class="token punctuation">.</span>p<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

currentState <span class="token operator">===</span> nextState<span class="token punctuation">;</span> <span class="token comment">// true,仍然相等</span>
</code></pre></div><h3 id="第二种使用方式"><a href="#第二种使用方式" class="header-anchor">#</a> 第二种使用方式</h3> <p>利用高阶函数，提前生成一个生产者producer。</p> <p>语法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">produce</span><span class="token punctuation">(</span>
  <span class="token function-variable function">recipe</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">draftState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span> <span class="token operator">|</span> draftState<span class="token punctuation">,</span>
  <span class="token operator">?</span>PatchListener
<span class="token punctuation">)</span><span class="token punctuation">(</span>currentState<span class="token punctuation">)</span> <span class="token operator">:</span> nextState
</code></pre></div><p>例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> producer <span class="token operator">=</span> <span class="token function">produce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">draft</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  draft<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> nextState <span class="token operator">=</span> <span class="token function">producer</span><span class="token punctuation">(</span>currentState<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>recipe是否有返回值，nextState的生成过程时不同的：</p> <ul><li>无返回值，nextState根据recipe函数内的draftState生成的。</li> <li>有返回值，nextState根据recipe函数的返回值生成的。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 此时，nextState不是通过draftState生成的，而是通过recipe的返回值生成的。</span>
<span class="token keyword">let</span> nextState <span class="token operator">=</span> <span class="token function">produce</span><span class="token punctuation">(</span>
  currentState<span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">draftState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      x<span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>recipe中的this</p> <p>recipe函数内部的<code>this</code>指向draftState，也就是修改<code>this</code>与修改recipe的参数draftState，效果是一样的。</p> <p><strong>注意：此处的recipe函数不能是箭头函数，如果是箭头函数，<code>this</code>就无法指向draftState了。</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">produce</span><span class="token punctuation">(</span>currentState<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">draft</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 此处，this指向draftState</span>
  draft <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="解决问题"><a href="#解决问题" class="header-anchor">#</a> 解决问题</h2> <p>在React框架中，<code>setState</code>支持函数式写法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>state<span class="token punctuation">,</span>
  isShow<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上述情况，配合解构语法，写起来还算优雅。那么数据稍微复杂一点呢？我们就得忍受&quot;糟糕的Immutable了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 比如更改对象数组中其中一个对象的键值时</span>

<span class="token comment">// 第一种方法，直接调用setState函数</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>members<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  members<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token operator">...</span>members<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      age<span class="token operator">:</span> members<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>age <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>members<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 第二种，通过setState的函数</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>members<span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    members<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token operator">...</span>members<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        age<span class="token operator">:</span> members<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>age <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token operator">...</span>members<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
</code></pre></div><p>然后有了Immer后，一切都不一样了：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token function">produce</span><span class="token punctuation">(</span><span class="token parameter">draft</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  draft<span class="token punctuation">.</span>members<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>age<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="方便的柯里化"><a href="#方便的柯里化" class="header-anchor">#</a> 方便的柯里化</h3> <p>Immer支持柯里化，所以我们可以直接把一次性改变两个参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> oldObj <span class="token operator">=</span> <span class="token punctuation">{</span>value<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newObj <span class="token operator">=</span> <span class="token function">produce</span><span class="token punctuation">(</span>oldObj<span class="token punctuation">,</span> <span class="token parameter">draft</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>draft<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这就是Immer的哲学：<strong>Create the next immutable state by mutating the current one.</strong></p> <h2 id="优化redux"><a href="#优化redux" class="header-anchor">#</a> 优化Redux</h2> <p>在正式优化之前，我们先看一下produce<a href="/library/knowledge/web/react/Immer.html#第二种使用方式">第二种使用方式</a>的拓展用法：</p> <p>例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> producer <span class="token operator">=</span> <span class="token function">produce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">draft<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  obj <span class="token operator">===</span> arg<span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> nextState <span class="token operator">=</span> <span class="token function">producer</span><span class="token punctuation">(</span>currentState<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>相比produce第二种使用方式的例子，多定义了一个<code>obj</code>对象，并将其作为producer方法的第2个参数传了进去；可以看到，produce内的recipe回调函数的第2个参数与<code>obj</code>对象指向的是同一块内存。</p> <p>现在让我们看看produce这种拓展用法，在Redux能发挥怎样的功效？</p> <h3 id="普通reducer怎么解决上面的react需求"><a href="#普通reducer怎么解决上面的react需求" class="header-anchor">#</a> 普通reducer怎么解决上面的React需求</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'ADD_AGE'</span><span class="token operator">:</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> members <span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        members<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token operator">...</span>members<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            age<span class="token operator">:</span> members<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>age <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token operator">...</span>members<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="引入immer后，reducer可以这样写"><a href="#引入immer后，reducer可以这样写" class="header-anchor">#</a> 引入immer后，reducer可以这样写</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">produce</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token parameter">draft</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'ADD_AGE'</span><span class="token operator">:</span>
      draft<span class="token punctuation">.</span>members<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>age<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以看见，通过produce，代码已经精简了非常多。</p> <p>不过，我们还可以利用produce能够先制造出producer（柯里化）的特点，代码还可以更优雅：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">produce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">draft<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'ADD_AGE'</span><span class="token operator">:</span>
      draft<span class="token punctuation">.</span>members<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>age<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>至此，Immer优化reducer的方法已经完毕。</p> <h2 id="相关文档"><a href="#相关文档" class="header-anchor">#</a> 相关文档</h2> <ul><li><a href="https://immerjs.github.io/immer/docs/introduction" target="_blank" rel="noopener noreferrer">Immer 官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/immerjs/immer" target="_blank" rel="noopener noreferrer">Immer github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最近更新时间:</span> <span class="time">2020-7-28 2:56:06 ├F10: PM┤</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/library/knowledge/web/react/ReactHooks.html" class="prev">
        React Hooks
      </a></span> <span class="next"><a href="/library/knowledge/web/react/ReduxThunk.html">
        Redux-thunk
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/library/assets/js/app.68a91983.js" defer></script><script src="/library/assets/js/2.d8add0a0.js" defer></script><script src="/library/assets/js/210.c0753af3.js" defer></script><script src="/library/assets/js/3.dc7ea838.js" defer></script>
  </body>
</html>
